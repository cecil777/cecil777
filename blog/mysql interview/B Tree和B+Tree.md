# 为什么Mysql不用B树而使用B+树

- 因为B数据每个节点都存储数据，每次查询的数据大小固定，就会造成每次查询返回的数据的条数变少，相同数据规模的情况下，B树会增加io次数，而B+树，则数据量较少，一次可以返回多条记录，io次数较少。
- 范围查询B+树明显优于B树 （B+树结果的数据结构是双向链表）

为什么关系型数据库都选择了B+树，这个和磁盘的特性有着非常大的关系。

为了提高效率，要尽量减少磁盘io。为了达到这个目的，磁盘往往不是严格按需读取，而是每次都会预读，即时只需要一个字节，磁盘也会从这个位置开始，顺序向后读取一定长度的数据放入内存，这个称之为预读。

预读的长度一般为页（page）的整倍数。页是计算机管理存储器的逻辑块，硬件及操作系统往往将主存和磁盘存储区分割为连续的大小相等的块，每个存储块称为一页，页的大小通常为4k。

按照磁盘的这种性质，如果是一个页存放一个B+树的节点，自然是可以存放很多的数据，比如InnoDB里，默认定义的B+树的节点大小是16KB，这就是说，假如一个Key是8个字节，那么一个节点可以存放大约1000个Key，意味着B+树可以有1000个分叉。同时InnoDB每一次磁盘io，读取的都是16KB的整数倍数据。也就是说InnoDB在节点的读取上是可以充分利用磁盘顺序io的高速读写特性。

同时按照B+树逻辑结构来说，在叶子节点一层，所有记录的主键按照从小到大的顺序排列，并且形成了一个双向链表。同一层的非叶子节点也互相单联，形成了一个双向链表，那么在实际读写的时候，很大的概率相邻的节点会放在相邻的页上，又可以充分利用磁盘顺序io的高速读写特性。

所以我们对MySQL优化的一大方向就是**尽可能的多让数据顺序读写，少让数据随机读写**

磁盘顺序读取的效率很高（不需要寻道时间，只需要很少的旋转时间），一般来说磁盘的顺序读的效率是随机读的40到400倍都有可能，顺序写是随机写的10到100倍。

# B+树的作用总结

- 在磁盘设备上，通过B+树可以有效的存储数据。
- 所有记录都存储在叶子节点上，非叶子（non-leaf）存储索引（keys）信息；而且记录按照索引列的值由小到大排好序
- B+树含有非常高的扇出（fanout），通常超过100，在查找一个记录时，可以有效的减少io操作

扇出：是每个索引节点（non-leaf）指向每个叶子结点（leaf）的指针

三层的B+树可以存储2000多W的数据
